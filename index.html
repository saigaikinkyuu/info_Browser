<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <script src="https://code.jquery.com/jquery-1.6.4.js"></script>
    <title>JMA-INFO受信端末</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New&display=swap" rel="stylesheet">
  </head>
  <body>
    <style>
      img{
        height: 345px;
        padding-top: 2px;
      }
      *{
        font-family: "Zen Kaku Gothic New", sans-serif;
        font-weight: 400;
        font-style: normal;
      }
    </style>
    <div data-type="quake">
      <div id="div" onclick="stop(0)">
        <div style="display: flex;"><span class="material-symbols-outlined" id="icon" style="font-size: 75px;"></span><h1 id="kind"></h1></div>
        <div id="body" style="font-size: 20px;white-space: pre-line;"></div>
      </div>
    </div>
    <div data-type="tsunami">
      <div id="div-tsunami" onclick="stop(1)">
        <div style="display: flex;"><span class="material-symbols-outlined" id="icon-tsunami" style="font-size: 75px;"></span><h1 id="kind-tsunami"></h1></div>
        <div id="body-tsunami" style="font-size: 20px;white-space: pre-line;"></div>
      </div>
    </div>
    <button onclick="requestAutoplayPermission()">ボタン</button>
    <script src="https://cdn.jsdelivr.net/npm/howler@2.2.3/dist/howler.js" defer></script>
    <script>
      window.setInterval(check, 3000);
      window.setInterval(quakeNews, 1000);
      var attend = "";
      var eew = "";
      var tsunami = "";
      var quake = "";
      var tsunamiNotify = "";
      var error = "";
      var num = 0;
      var num2 = false;
      var num4 = 0
      error = false
      // ユーザーが許可したかどうかを示すフラグ
      let autoplayAllowed = false;

      // オーディオの再生を試みる関数
      function tryPlayAudio() {
      // ユーザーが許可している場合にのみ再生する
      if (autoplayAllowed) {
          var Test = new Howl({
            src: 'https://monitor.jkisyou.com/audio/Test.mp3',
            autoplay: false,
            volume: 1,
            loop: false
          });
          Test.play();
      }}

       // ユーザーが許可するための関数
       function requestAutoplayPermission() {
         const el = document.getElementById('button');
         el.onclick = function(){
         // ユーザーに許可を求めるためのロジックをここに追加
         // 例えば、ユーザーがボタンをクリックすると許可されるようにするなど

         // ユーザーが許可した場合、フラグをtrueに設定する
         autoplayAllowed = true;
         }
       }

      function check(){
        try{
          if(new Date().getMinutes() === 05 || new Date().getMinutes() === 15 || new Date().getMinutes() === 25 || new Date().getMinutes() === 35 || new Date().getMinutes() === 45 || new Date().getMinutes() === 55){
            if(new Date().getSeconds() === 00 || new Date().getSeconds() === 01 || new Date().getSeconds() === 02 || new Date().getSeconds() === 03){
              location.reload();
            }
          }
              url = 'https://script.google.com/macros/s/AKfycbzWwdwhIWUxEW0jqVFZn1g4ycEU78HVrQC-ucsKd9U7gVK8vEfQ43LLTwusw4ilrLIkLA/exec';
              fetch(url)
                .then(response => response.json())
                .then(data => {
                  if(attend !== data[0].Kind && attend !== ""){
                      attend = data[0].Kind;
                      if(num2 === true){
                        num4 = 2
                        document.getElementById("icon").textContent = "mail"
                        document.getElementById("kind").textContent = "【訓練】地震検知(第一報)[" + data[0].Time + "]"
                        document.getElementById("body").textContent = "訓練。訓練です。" + new Date().getHours() + "時" + new Date().getMinutes() + "分頃、東京湾にて、推定最大震度1の地震が発生しました。\n津波の発生の可能性が考えられます。海岸付近から離れてください。\n地震の詳細です。深さ50km、マグニチュード3.2"
                        tryPlayAudio()
                      }
                  }else if(attend === ""){
                    attend = data[0].Kind
                    console.log(attend)
                  }else{
                  }
                });
        }
        }catch(e){
          console.error(e.message + e.lineNumber)
          document.getElementById("icon").textContent = "error"
          document.getElementById("kind").textContent = "エラー"
          document.getElementById("body").textContent = "現在、エラーが発生しております。\nエラーの詳細。" + e.message
          announceN.play();
          function errorStop(){
            announceN.stop();
          }
        }
      }
      function stop(num){
        if(num === 0){
          document.getElementById("icon").textContent = "drafts"
        }else if(num === 1){
          document.getElementById("icon-tsunami").textContent = "drafts"
        }
        num4 = 1
      }
    </script>
  </body>
</html>
